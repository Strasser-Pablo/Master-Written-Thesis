\chapter{Fixed}
\minitoc
\section{Introduction}

We will in this chapter be interested in the case of fixed domain Navier-Stokes with grid discretisation.
This case is easier than the variable domain case and serve as basis to more complicated case.

\section{Overview}

We will in this chapter present two way to solve Navier-Stokes equation.
We will show that this two method are equivalent if a Runge-Kutta method is used to solve.

The two method are presented at next section.
\subsection{Analytical expression for pressure}
\label{fixed:analytical}

We use the work of section \ref{analytical:fixe_eulerian} that Navier-Stokes equation is analytically equivalent to:
\begin{equation}
  \partial_t \vect{v}(\vect{x} ,t)=(\eye+P)f(\vect{v}(\vect{x},t))
\end{equation}

$\eye+P$ project a none divergence free vector to a divergence free vector.
The solution $\vect{v}$ is a divergence free vector. Because the integral of a divergence free vector is again a divergence free vector.

But a priori the numerical solution is not necessary divergence free.

\subsection{Projection of speed}
\label{fixed:proj}

We can project every speed in a divergence free space:
\begin{subequations}
\begin{align}
  \partial_t \vect{\tilde{v}}(\vect{x} ,t)&=f(\vect{v}(\vect{x},t))\\
  \vect{v}(\vect{x},t)&=(\eye+P)\vect{\tilde{v}}
\end{align}
\end{subequations}

We have the certitude to be always divergence free by construction.

\section{Runge-Kutta}

A Runge-Kutta method is a method to solve the ODE (I drop the $\vect{x}$ dependence, but it's understood that this equation is for a vector formed in concatenating every speed):
\begin{equation}
\partial_t \vect{v}(t)=f(\vect{v})
\end{equation}

The solution at time $n+1$ is given from the solution at time $n$ with $\Delta t$ the time step and $a$, $b$ parameter of the method.
\begin{subequations}
\begin{align}
	\vect{v}_{n+1}&=\vect{v}_{n}+\sum_{i=1}^{s}b_{i}k_{i}\\
	k_{j}&=\Delta t f(\vect{v}_{n}+\sum_{i=1}^{j-1}a_{j,i}k_{i})
\end{align}
\end{subequations}

\section{Runge-Kutta based scheme}

We now integrate method \ref{fixed:analytical} and \ref{fixed:proj} with a Runge-Kutta method.

Scheme for projection at every evaluation of speed:
\begin{subequations}
\begin{align}
\vect{\tilde{v}}_{n+1}&=\vect{\tilde{v}}_{n}+\sum_{i=1}^{s}b_{i}\tilde{k}_{i}+P\left(\vect{\tilde{v}}_{n}+\sum_{i=1}^{s}b_{i}\tilde{k}_{i}\right)\\
\tilde{k}_{i}&=\Delta t f\left(\vect{\tilde{v}}_{n}+\sum_{j=1}^{i-1}a_{ij}\tilde{k}_{j}+P\left(\vect{\tilde{v}}_{n}+\sum_{j=1}^{i-1}a_{ij}\tilde{k}_{j}\right)\right)
\end{align}
\end{subequations}

We project at every estimation of speed. Making by construction every speed divergence free.

Scheme for analytical expression for pressure:
\begin{subequations}
\begin{align}
	\vect{v}_{n+1}&=\vect{v}_{n}+\sum_{i=1}^{s}b_{i}k_{i}\\
	k_{i}&=\Delta t f\left(\vect{v}_{n}+\sum_{j=1}^{i-1}a_{ij}k_{j}\right)+\Delta t P\left(f\left(\vect{v}_{n}+\sum_{j=1}^{i-1}a_{ij}k_{j}\right)\right)
\end{align}
\end{subequations}

The following theorem show that the two scheme are the same.

\begin{theorem}
If $\vect{v}_{n}=\vect{\tilde{v}}_{n}$ and $\vect{v}_n$ is divergence free then $\vect{v}_{n+1}=\vect{\tilde{v}}_{n+1}$ 
\end{theorem}
\begin{proof}
We begin by prove the following lemma.
\begin{lemma}
\begin{equation}
  k_{i}=\tilde{k}_{i}+P(\tilde{k}_{i})
\end{equation}
\end{lemma}
\begin{proof}
By recurrence on $i$.
We begin with $i=1$:
\begin{equation}
  k_{1}=\Delta tf\left(\vect{v}_n\right)+\Delta tP\left(f\left(\vect{v}_n\right)\right)
\end{equation}
\begin{equation}
\tilde{k}_{1}=\Delta tf\left(\vect{v}_n\right)
\end{equation}
\begin{equation}
  k_{1}=\Delta t f\left(\vect{v}_n\right)+\Delta tP\left(f\left(\vect{v}_n\right)\right)=\tilde{k}_1+P\left(\tilde{k}_1\right)
\end{equation}

Assuming true for smaller $i$:
\begin{align*}
  k_{i}&=\Delta tf\left(\vect{v}_n+\sum_{j=1}^{n}a_{ij}k_{j}\right)+\Delta tP\left(f\left(\vect{v}_n+\sum_{j=1}^{i-1}a_{ij}k_{ij}\right)\right)\\
  &=\Delta tf\left(\vect{v}_n+\sum_{j=1}^{i-1}a_{ij}\left(\tilde{k}_{j}+P\left(\tilde{k}_{j}\right)\right)\right)+\Delta tP\left(f\left(\vect{v}_n+\sum_{j=1}^{i-1}a_{ij}\left(\tilde{k}_{j}+P\left(\tilde{k}_{j}\right)\right)\right)\right)\\
  \tilde{k}_{i}&=\Delta tf\left(\vect{v}_n+\sum_{j=1}^{i-1}a_{ij}\tilde{k}_{j}+P\left(\vect{v}_n+\sum_{j=1}^{i-1}a_{ij}\tilde{k}_{j}\right)\right)\\
  &=\Delta tf\left(\vect{v}_n+\sum_{j=1}^{i-1}a_{ij}\left(\tilde{k}_{j}+P\left(\tilde{k}_{j}\right)\right)\right)\\
  k_{i}&=\tilde{k}_{i}+P\left(\tilde{k}_{i}\right)
\end{align*}
\end{proof}

We now write the expression for $\vect{v}_{n+1}$ and $\vect{\tilde{v}}_{n+1}$ using the lemma.

\begin{align*}
\vect{v}_{n+1}&=\vect{v}_{n}+\sum_{i=1}^{s}b_{i}k_{i}\\
&=\vect{v}_{n}+\sum_{i=1}^{s}b_{i}\left(\tilde{k}_{i}+P\left(\tilde{k}_{i}\right)\right)\\
\vect{\tilde{v}}_{n+1}&=\vect{\tilde{v}}_{n}+\sum_{i=1}^{s}b_{i}\tilde{k}_{i}+P\left(\vect{\tilde{v}}_{n}+\sum_{i=1}^{s}b_{i}\tilde{k}_{i}\right)\\
&=\vect{\tilde{v}}_{n}+\sum_{i=1}^{s}b_{i}\left(\tilde{k}_{i}+P\left(\tilde{k}_{i}\right)\right)\\
\intertext{Using that $\vect{v}_{n}=\tilde{\vect{v}_{n}}$}
\vect{v}_{n+1}&=\vect{\tilde{v}}_{n+1}
\end{align*}

\end{proof}

\begin{theorem}
For the implicit Runge-Kutta case, where the sum to $i-i$ go now to $s$.
If $\vect{v}_{n}=\vect{\tilde{v}}_{n}$ and $\vect{v}_n$ is divergence free then $\vect{v}_{n+1}=\vect{\tilde{v}}_{n+1}$ 
\end{theorem}
\begin{proof}
We begin by prove the following lemma.
\begin{lemma}
After relabeling noting $k_{i}^{j}$ the $j$ solution of $k_{i}$.
We have for every $j$.
\begin{equation}
  k_{i}=\tilde{k}_{i}^{j}+P(\tilde{k}_{i}^{j})
\end{equation}
This doesn't say that we have existence and unicity of the solution only that if we have a set of solution for $k$ we have a bijection
to solution of $\tilde{k}$
\end{lemma}
\begin{proof}
Because the sum goes to $s$ and not $i-1$ we cannot use recurrence.
We now will use vector notation for $k$.

We construct $k$ and $\tilde{k}$ vector with the vector $k_{i}$ and $\tilde{k}_{i}$
\begin{align}
k&=\begin{pmatrix}
    k_{1}\\
    \vdots\\
    k_{s}\\
  \end{pmatrix}\\
\tilde{k}&=\begin{pmatrix}
    \tilde{k}_{1}\\
    \vdots\\
    \tilde{k}_{s}\\
  \end{pmatrix}
\end{align}

We form $\hat{P}$ and $\hat{f}$ from a Kronecker product:
\begin{align}
\hat{P}&=\eye_{s}\kron P=\begin{pmatrix}P	&\ldots	&0\\
			\vdots &\ddots 	&\vdots\\
			0	&0	&P\\
	\end{pmatrix}\\
\hat{f}&=\eye_{s}\kron f\begin{pmatrix}f	&\ldots	&0\\
			\vdots &\ddots 	&\vdots\\
			0	&0	&f\\
	\end{pmatrix}
\end{align}

We now define $\hat{v}_n$:
\begin{equation}
\hat{v}_{n}=\begin{pmatrix}
	      v_{n}\\
	      \vdots\\
	      v_{n}
	      \end{pmatrix}
\end{equation}

We now define $\hat{A}$ with the following Kronecker product:
\begin{equation}
\hat{A}=\begin{pmatrix}
    a_{11}	&\ldots	&a_{1s}\\
    \vdots	&\ddots	&\vdots\\
    a_{s1}	&\ldots	&a_{ss}\\
  \end{pmatrix} \kron \eye=A \kron \eye
\end{equation}

$\hat{A}$ and $\hat{P}$ are commutative, because of the mixed-product property.
\begin{align}
\hat{A}\hat{P}&=\left(A\kron \eye \right)
  \left(\eye_{s}\kron P\right)=
	A\kron P\\
    %
    \hat{P}\hat{A}&=
  \left(\eye_{s}\kron P\right)
	\left(A \kron \eye \right)=
	A\kron P
\end{align}

\begin{align}
k&=(1+\hat{P})\Delta t\hat{f}(\hat{v}_{n}+\hat{A}k)\\
\tilde{k}&=\Delta t \hat{f}((1+\hat{P})(\hat{v}_{n}+\hat{A}k))
\end{align}

We begin to define 2 functions:
\begin{align}
k&=g(k)\\
\tilde{k}&=\tilde{g}(\tilde{k})\\
g(x)&=(1+\hat{P})\Delta t \hat{f}(\hat{v}_{n}+\hat{A}x)\\
\tilde{g}(x)&=\Delta t \hat{f}((1+\hat{P})(\hat{v}_{n}+\hat{A}x))
\end{align}

$k$ and $\tilde{k}$ are fixed point of function $g$ and $\tilde{g}$.

We now calculate:
\begin{align}
(1+\hat{P})\tilde{g}(x)&=(1+\hat{P})\Delta t \hat{f}((1+\hat{P})(\hat{v}_{n}+\hat{A}x))=(1+\hat{P})\Delta t \hat{f}(\hat{v}_{n}+\hat{A} (1+\hat{P})x)\\
&=g((1+\hat{P})x)
\end{align}

We now substitute $g$ in $\tilde{g}$
\begin{equation}
(1+\hat{P})\tilde{k}=g((1+\hat{P})\tilde{k})
\end{equation}

$(1+\hat{P})\tilde{k}$ is a fixed point of $g$.
But fixed point of $g$ is $k$.

This directly give the result with $k^{j}$ the $j$ solution:
\begin{equation}
k^{j}=(1+\hat{P})\tilde{k}^{j}
\end{equation}
This is exactly the vector version of what we wanted to prove.
\end{proof}

The rest is exactly the same than in the first case.

To not overload the proof with notation, we drop the $j$ label to indicate witch solution we take.
We now write the expression for $\vect{v}_{n+1}$ and $\vect{\tilde{v}}_{n+1}$ using the lemma.
\begin{align*}
\vect{v}_{n+1}&=\vect{v}_{n}+\sum_{i=1}^{s}b_{i}k_{i}\\
&=\vect{v}_{n}+\sum_{i=1}^{s}b_{i}\left(\tilde{k}_{i}+P\left(\tilde{k}_{i}\right)\right)\\
\vect{\tilde{v}}_{n+1}&=\vect{\tilde{v}}_{n}+\sum_{i=1}^{s}b_{i}\tilde{k}_{i}+P\left(\vect{\tilde{v}}_{n}+\sum_{i=1}^{s}b_{i}\tilde{k}_{i}\right)\\
&=\vect{\tilde{v}}_{n}+\sum_{i=1}^{s}b_{i}\left(\tilde{k}_{i}+P\left(\tilde{k}_{i}\right)\right)\\
\intertext{Using that $\vect{v}_{n}=\tilde{\vect{v}_{n}}$}
\vect{v}_{n+1}&=\vect{\tilde{v}}_{n+1}
\end{align*}

\end{proof}

\begin{corollary}
Solving Navier-Stokes equation with the analytical good choice of pressure.
Is exactly divergence free at every approximation of speed.
\end{corollary}
\begin{proof}
  The expression of $v$ is the solution of the Navier-Stokes equation with the good choice of pressure.
  $\tilde{v}$ is the solution of Runge-Kutta equation without pressure witch is projected at every speed estimation.
  This is divergence free.
  $v$ and $\tilde{v}$ are the same. With end the proof.
\end{proof}

\begin{corollary}
  Using the expression for $v$ or $\tilde{v}$ we are $k$ order precise in time. Where $k$ is the order of the Runge-Kutta method.
\end{corollary}
\begin{proof}
  $v$ and $\tilde{v}$ are the same.
  $v$ consist only of a Runge-Kutta method with a good chosen function.
  So the order in time of $v$ and $\tilde{v}$ is the same that the method order.
\end{proof}

\section{Spatial discretization}

\subsection{Unstaggered grid}

On an unstaggered grid we put the variable like figure \ref{fixed:unstaggered}.

\begin{figure}
\directlua{dofile('fixed/unstaggered.lua')}
\caption{Position of variable for unstaggered grid}
\label{fixed:unstaggered}
\end{figure}

The problem with unstaggered grid, is that obvious center difference discretization lead to wrong divergence free vector.

We define the derivative of a scalar by:
\begin{equation}
  \partial_x a_i=\frac{a_{i+1}-a{i-1}}{\Delta x}
\end{equation}

The divergence discretisation is then given by (notation for 2d, but for 3d it's the same):
\begin{equation}
  \vect{\nabla} \cdot \vect{v}_{i,j}=\frac{{v_{x}}_{i+1,j}-{v_{x}}_{i-1,j}}{\Delta x}+\frac{{v_{y}}_{i+1,j}-{v_{y}}_{i-1,j}}{\Delta y}
\end{equation}

The problem can be see in figure \ref{fixed:unstaggered_div} is that the divergence at red point only use value at blue point and not the point at center (red point).
This allow to have none physical solution that are divergence free.

\begin{figure}
\directlua{dofile('fixed/unstaggered_div.lua')}
\caption{Value used to calculate the divergence at red point are in blue}
\label{fixed:unstaggered_div}
\end{figure}

In figure \ref{fixed:unstaggered_div2} we have solution that is numerically divergence free. But this solution is not continuous and we expect that is not divergence free.

\begin{figure}
\directlua{dofile('fixed/unstaggered_div2.lua')}
\caption{Speed that are numerically divergence free but should'nt}
\label{fixed:unstaggered_div2}
\end{figure}

The problem with this kind of solution, is that it's very stable.
The projection operator $P$ will be 0, and don't correct this kind of speed. We cannot correct it in general for every choice of $f$.

We can recall one of the formulation of the so call Murphy's law, ``If anything can go wrong, it will.''

We can correct this problem with using a forward or backward expression. But this kind of expression is only first order accurate.

Another solution is to use another grid.

\subsection{Staggered grid}

On a staggered grid we put the variable in the position shown if figure \ref{fixed:staggered}.

\begin{figure}
\directlua{dofile('fixed/staggered.lua')}
\caption{Position of variable on a staggered grid}
\label{fixed:staggered}
\end{figure}

This can seem to be strange to have different component of speed at different place. But it make discretization more easy.

To label variable, we label by cell and then took the lower,left component (cf. figure \ref{fixed:staggered_label}).

\begin{figure}
\directlua{dofile('fixed/staggered_label.lua')}
\caption{Labeling on staggered grid}
\label{fixed:staggered_label}
\end{figure}

We now define the divergence and the gradient:
\begin{align}
  \vect{\nabla}p_{ij}&=\begin{pmatrix}
    \frac{p_{i,j}-p_{i-1,j}}{\Delta x}\\
    \frac{p_{i,j}-p_{i,j-1}}{\Delta y}\\
                      \end{pmatrix}\\
  \vect{\nabla}\cdot \vect{v}_{i,j}&=\frac{{v_{x}}_{i+1,j}-{v_{x}}_{i,j}}{\Delta x}+\frac{{v_{y}}_{i,j+1}-{v_{y}}_{i,j}}{\Delta y}
\end{align}

This two expression are geometrically very clear.

In figure \ref{fixed:staggered_gradient}, the gradient at red speed component use component at blue point.
Contrary at case with center difference we cannot create a none constant vector with 0 gradient.

\begin{figure}
\directlua{dofile('fixed/staggered_gradient.lua')}
\caption{Point used to calculate the red gradient component are in blue}
\label{fixed:staggered_gradient}
\end{figure}

The divergence is given by the sum of inflow around a cell.
In figure \ref{fixed:staggered_divergence}, the divergence at red point use component at blue point.

\begin{figure}
\directlua{dofile('fixed/staggered_divergence.lua')}
\caption{Point used to calculate red divergence are in blue}
\label{fixed:staggered_divergence}
\end{figure}

We cannot have the same situation than without staggered grid, where an unphysical vector is divergence free.

\subsubsection{Discretization}

We now look at different possible scheme for staggered grid discretization.

\paragraph{Gradient}
The gradient is discretized with center difference.

\begin{equation}
  \vect{\nabla}p_{i,j}=\begin{pmatrix}
                       	\frac{p_{i-1,j}-p_{i,j}}{\Delta x}\\
                       	\frac{p_{i,j-1}-p_{i,j}}{\Delta y}\\
                       \end{pmatrix}
\end{equation}

Center difference is second order accurate to the contrary to forward or backward difference.

\paragraph{Divergence}
The divergence is discretized with center difference.

\begin{equation}
	\vect{\nabla}\cdot \vect{v}_{i,j}=\frac{{v_{x}}_{i,j}-{v_{x}}_{i-1,j}}{\Delta x}+\frac{{v_{y}}_{i,j}-{v_{y}}_{i,j-1}}{\Delta y}
\end{equation}

Because of center difference, it's second order accurate.

\paragraph{Laplacian}
\label{fixed:Laplacian}
The discretization of the laplacian is the combination of the application of the gradient and divergence.

\begin{equation}
  \Delta p_{i,j}=\frac{p_{i+1,j}-2p_{i,j}+p_{i-1,j}}{(\Delta x)^2}+\frac{p_{i,j+1}-2p_{i,j}+p_{i,j-1}}{(\Delta y)^2}
\end{equation}

This formula is of order 2.

We prove it for the one dimensional case:
\begin{align*}
  f(x+\Delta x)-2f(x)+f(x-\Delta x)&=\\
  \intertext{We make a taylor expansion around $x$}
  &=f(x)+\Delta x f'(x) +(\Delta x)^2 \frac{f''(x)}{2}+(\Delta x)^3 \frac{f'''(x)}{6}+O((\Delta x)^4)-2f(x)\\
  &\qquad+f(x)-\Delta x f'(x) +(\Delta x)^2 \frac{f''(x)}{2}-(\Delta x)^3 \frac{f'''(x)}{6}\\
  &=(\Delta x)^2f''(x) +O((\Delta x)^4)\\
  f''(x)&=\frac{f(x+\Delta x)-2f(x)+f(x-\Delta x)}{(\Delta x)^2}+O((\Delta x)^2)
\end{align*}

\paragraph{Vector Laplacian}
For vector Laplacian we use the same scheme as in section \ref{fixed:Laplacian} but for every component of speed.

Staggered grid don't pose problem because we don't have mixed term with derivative and none derivative.

\paragraph{Convection}

Convection term is the more difficult term to treat, because it's none linear and use mixed term.

We need to consider two type of term. Let $i\neq j$. And $\vect{k}$ be a integer vector of the position on the grid.
And $\vect{e}_i$ the i\th unit vector.

We first consider as ith component:
\begin{equation}
\left(v_{i}\partial_{i}v_{i}\right)^{i}_{\vect{k}}
\end{equation}

We can discretize this in two manner:

\subparagraph{Central difference}
\begin{equation}
{v_{i}}_{\vect{k}}\frac{{v_{i}}_{\vect{k}+\vect{e}_i}-{v_{i}}_{\vect{k}-\vect{e}_i}}{2\Delta x_{i}}
\end{equation}

\subparagraph{Upwind difference}

We use the same method, but instead to use center difference, we use upwind:

\begin{align}
\intertext{if ${v_{i}}_{\vect{k}}<0$}
\left(v_{i}\partial_{i}v_{i}\right)_{\vect{k}}&={v_{i}}_{\vect{k}}\frac{{v_{i}}_{\vect{k}+\vect{e}_i}-{v_{i}}_{\vect{k}}}{\Delta x_{i}}\\
\intertext{if ${v_{i}}_{\vect{k}}>0$}
\left(v_{i}\partial_{i}v_{i}\right)_{\vect{k}}&={v_{i}}_{\vect{k}}\frac{{v_{i}}_{\vect{k}}-{v_{i}}_{\vect{k}-\vect{e}_i}}{\Delta x_{i}}\\
\intertext{if ${v_{i}}_{\vect{k}}=0$}
\left(v_{i}\partial_{i}v_{i}\right)_{\vect{k}}&=0
\end{align}

Upwind is considered more stable (can be proof easly in one dimension for burger's equation) but more diffusif.

We now consider:
\begin{equation}
\left(v_{j}\partial_{j}v_{i}\right)^{i}_{\vect{k}}
\end{equation}

\begin{remark}
  Contrary to the other case, we need to have the speed at a position not know for $v_{j}$. This come because of the staggered grid sheme.
  For this, we can interpolated the know speed of neighbour cell taking for example the average of the 4 neighbour (cf. figure \ref{fixed:staggered_convection_upwind}).
  We will use as notation $v_{j}^{i}$ for the speed component $j$ at position for the component $i$.
  
  \begin{figure}
    \directlua{dofile('fixed/staggered_convection_upwind.lua')}
    \caption{We need the value of the red arrow. For this we can interpolated from the blue arrow.}
    \label{fixed:staggered_convection_upwind}
    \end{figure}
\end{remark}

We can discretize this in two manner:

\subparagraph{Central difference}
\begin{equation}
\left(v_{j}\partial_{j}v_{i}\right)^{i}_{\vect{k}}={v_{j}^{i}}_{\vect{k}}\frac{{v_{i}}_{\vect{k}+\vect{e}_j}-{v_{i}}_{\vect{k}-\vect{e}_j}}{2\Delta x_{j}}
\end{equation}

\subparagraph{Upwind difference}

We use the same method, but instead to use center difference, we use upwind:

\begin{align}
\intertext{if ${v_{j}^{i}}_{\vect{k}}<0$}
\left(v_{j}\partial_{j}v_{i}\right)^{i}_{\vect{k}}&={v_{j}^{i}}_{\vect{k}}\frac{{v_{i}}_{\vect{k}+\vect{e}_j}-{v_{i}}_{\vect{k}}}{\Delta x_{j}}\\
\intertext{if ${v_{j}^{i}}_{\vect{k}}>0$}
\left(v_{j}\partial_{j}v_{i}\right)^{i}_{\vect{k}}&={v_{j}^{i}}_{\vect{k}}\frac{{v_{i}}_{\vect{k}}-{v_{i}}_{\vect{k}-\vect{e}_j}}{\Delta x_{j}}\\
\intertext{if ${v_{j}^{i}}_{\vect{k}}=0$}
\left(v_{j}\partial_{j}v_{i}\right)^{i}_{\vect{k}}&=0
\end{align}

Upwind is considered more stable (can be proven easly in one dimension for burger's equation) but more diffusive.

\section{Numerical experiment}

We will now do some numerical experiment in fixed boundary condition to show how it work.

\subsection{Forced wave problem}

In a rectangular pool with Von-Neumann boundary condition (except to one point to fix the constant) in pressure.
We begin with a zero speed initial condition with a forced speed at one of the boundary.
The choose of Von-Neumann boundary condition ensure that pressure will not change the velocity at the boundary of the pool if possible.

\subsubsection{Constant speed case}

We begin with the case where the input speed is constant and normal to the boundary.

\subsection{Heat Equation}
\pgfplotstableread{fixed/solheat/sol_0.txt}\HeatSolaa
%\pgfplotstabletypeset[columns={x,u}]\HeatSolaa

\pgfplotstableread{fixed/solheat/sol_1.txt}\HeatSola
%\pgfplotstabletypeset[columns={x,u}]\HeatSola

\pgfplotstableread{fixed/solheat/sol_10.txt}\HeatSolb
%\pgfplotstabletypeset[columns={x,u}]\HeatSolb

\pgfplotstableread{fixed/solheat/sol_100.txt}\HeatSolc
%\pgfplotstabletypeset[columns={x,u}]\HeatSolc

\pgfplotstableread{fixed/solheat/sol_200.txt}\HeatSold
%\pgfplotstabletypeset[columns={x,u}]\HeatSold

\pgfplotstableread{fixed/solheat/sol_300.txt}\HeatSole
%\pgfplotstabletypeset[columns={x,u}]\HeatSole

\pgfplotstableread{fixed/solheat/sol_400.txt}\HeatSolf
%\pgfplotstabletypeset[columns={x,u}]\HeatSolf

\pgfplotstableread{fixed/solheat/sol_500.txt}\HeatSolg
%\pgfplotstabletypeset[columns={x,u}]\HeatSolg

\begin{figure}
\begin{tikzpicture}
	\begin{axis}[width=\textwidth,only marks,use units,x unit=m,y unit=\frac{m}{s},xlabel=$x$ Position,ylabel=$y$ Speed,scaled x ticks=real: 0.01
	,xtick scale label code/.code={$\cdot 10^{-2}$}]
		\addplot table[x=x,y=u]{\HeatSolaa};
		\label{fix:heatSol0}
		\addlegendentry{$t=0s$}
		\addplot table[x=x,y=u]{\HeatSola};
		\label{fix:heatSol1}
		\addlegendentry{$t=1s$}
		\addplot table[x=x,y=u]{\HeatSolb};
		\label{fix:heatSol10}
		\addlegendentry{$t=10s$}
		\addplot table[x=x,y=u]{\HeatSolc};
		\label{fix:heatSol100}
		\addlegendentry{$t=100s$}
		\addplot table[x=x,y=u]{\HeatSold};
		\label{fix:heatSol200}
		\addlegendentry{$t=200s$}
		\addplot table[x=x,y=u]{\HeatSole};
		\label{fix:heatSol300}
		\addlegendentry{$t=300s$}
		\addplot table[x=x,y=u]{\HeatSolf};
		\label{fix:heatSol400}
		\addlegendentry{$t=400s$}
		\addplot table[x=x,y=u]{\HeatSolg};
		\label{fix:heatSol500}
		\addlegendentry{$t=500s$}
	\end{axis}
\end{tikzpicture}
\caption[.]{
\begin{align*}
\ref{fix:heatSol0} t&=0& \ref{fix:heatSol100} t&=100&\ref{fix:heatSol400} t&=400&\\
\ref{fix:heatSol1} t&=16&\ref{fix:heatSol200} t&=200&\ref{fix:heatSol500} t&=500&\\
\ref{fix:heatSol10} t&=10&\ref{fix:heatSol300} t&=300&\\
\end{align*}
}
\end{figure}

\begin{figure}
\begin{tikzpicture}
	\begin{axis}[width=\textwidth,only marks,use units,x unit=m,y unit=\frac{m}{s},xlabel=$x$ Position,ylabel=$y$ Speed,scaled x ticks=real: 0.01
	,xtick scale label code/.code={$\cdot 10^{-2}$}]
		\addplot table[col sep=comma,x expr=\thisrow{x}+0.002,y=u]{fixed/solheat/data0_1.csv};
		\label{fix:heatdata0_1}
		\addplot table[col sep=comma,x expr=\thisrow{x}+0.002,y=u]{fixed/solheat/data2_1.csv};
		\label{fix:heatdata2_1}
		\addplot table[col sep=comma,x expr=\thisrow{x}+0.002,y=u]{fixed/solheat/data4_1.csv};
		\label{fix:heatdata4_1}
		\addplot table[col sep=comma,x expr=\thisrow{x}+0.002,y=u]{fixed/solheat/data5_1.csv};
		\label{fix:heatdata5_1}
		\addplot table[x=x,y=u]{\HeatSola};
		\label{fix:heatsol_1}
	\end{axis}
\end{tikzpicture}
\caption[.]{
\begin{align*}
&\text{Euler}&&\text{Runge-Kutta}&\\
\ref{fix:heatdata2_1} dt&=0.1& \ref{fix:heatdata5_1} dt&=0.1&\\
\ref{fix:heatdata0_1} dt&=1&\ref{fix:heatdata4_1} dt&=1&
\end{align*}
\begin{center}
\ref{fix:heatsol_1} Analytical
\end{center}
}
\end{figure}

\begin{figure}
\begin{tikzpicture}
	\begin{axis}[width=\textwidth,only marks,use units,x unit=m,y unit=\frac{m}{s},xlabel=$x$ Position,ylabel=$y$ Speed,scaled x ticks=real: 0.01
	,xtick scale label code/.code={$\cdot 10^{-2}$}]
		\addplot table[col sep=comma,x expr=\thisrow{x}+0.002,y=u]{fixed/solheat/data2_100.csv};
		\label{fix:heatdata2_100}
		\addplot table[col sep=comma,x expr=\thisrow{x}+0.002,y=u]{fixed/solheat/data0_100.csv};
		\label{fix:heatdata0_100}
		\addplot table[col sep=comma,x expr=\thisrow{x}+0.002,y=u]{fixed/solheat/data5_100.csv};
		\label{fix:heatdata5_100}
		\addplot table[col sep=comma,x expr=\thisrow{x}+0.002,y=u]{fixed/solheat/data4_100.csv};
		\label{fix:heatdata4_100}
		\addplot table[col sep=comma,x expr=\thisrow{x}+0.002,y=u]{fixed/solheat/data6_100.csv};
		\label{fix:heatdata6_100}
		\addplot table[x=x,y=u]{\HeatSolc};
		\label{fix:heatsol_100}
	\end{axis}
\end{tikzpicture}
\caption[.]{
\begin{align*}
&\text{Euler}&&\text{Runge-Kutta}&\\
\ref{fix:heatdata2_100} dt&=0.1& \ref{fix:heatdata5_100} dt&=0.1&\\
\ref{fix:heatdata0_100} dt&=1&\ref{fix:heatdata4_100} dt&=1&\\
\end{align*}
\begin{center}
\ref{fix:heatsol_100} Analytical
\end{center}
}
\end{figure}

\begin{figure}
\begin{tikzpicture}
	\begin{axis}[width=\textwidth,only marks,use units,x unit=m,y unit=\frac{m}{s},xlabel=$x$ Position,ylabel=$y$ Speed,scaled x ticks=real: 0.01
	,xtick scale label code/.code={$\cdot 10^{-2}$}]
		\addplot table[col sep=comma,x expr=\thisrow{x}+0.002,y=u]{fixed/solheat/data2_300.csv};
		\label{fix:heatdata2_300}
		\addplot table[col sep=comma,x expr=\thisrow{x}+0.002,y=u]{fixed/solheat/data0_300.csv};
		\label{fix:heatdata0_300}
		\addplot table[col sep=comma,x expr=\thisrow{x}+0.002,y=u]{fixed/solheat/data5_300.csv};
		\label{fix:heatdata5_300}
		\addplot table[col sep=comma,x expr=\thisrow{x}+0.002,y=u]{fixed/solheat/data4_300.csv};
		\label{fix:heatdata4_300}
		\addplot table[col sep=comma,x expr=\thisrow{x}+0.002,y=u]{fixed/solheat/data6_300.csv};
		\label{fix:heatdata6_300}
		\addplot table[x=x,y=u]{\HeatSole};
		\label{fix:heatsol_300}
	\end{axis}
\end{tikzpicture}
\caption[.]{
\begin{align*}
&\text{Euler}&&\text{Runge-Kutta}&\\
\ref{fix:heatdata2_300} dt&=0.1& \ref{fix:heatdata5_300} dt&=0.1&\\
\ref{fix:heatdata0_300} dt&=1&\ref{fix:heatdata4_300} dt&=1&\\
&&\ref{fix:heatdata6_300} dt&=2&
\end{align*}
\begin{center}
\ref{fix:heatsol_300} Analytical
\end{center}
}
\end{figure}

\begin{figure}
\begin{tikzpicture}
	\begin{axis}[width=\textwidth,only marks,use units,x unit=m,y unit=\frac{m}{s},xlabel=$x$ Position,ylabel=$y$ Speed,scaled x ticks=real: 0.01
	,xtick scale label code/.code={$\cdot 10^{-2}$}]
		\addplot table[col sep=comma,x expr=\thisrow{x}+0.002,y=u]{fixed/solheat/data2_500.csv};
		\label{fix:heatdata2_500}
		\addplot table[col sep=comma,x expr=\thisrow{x}+0.002,y=u]{fixed/solheat/data0_500.csv};
		\label{fix:heatdata0_500}
		\addplot table[col sep=comma,x expr=\thisrow{x}+0.002,y=u]{fixed/solheat/data5_500.csv};
		\label{fix:heatdata5_500}
		\addplot table[col sep=comma,x expr=\thisrow{x}+0.002,y=u]{fixed/solheat/data4_500.csv};
		\label{fix:heatdata4_500}
		\addplot table[col sep=comma,x expr=\thisrow{x}+0.002,y=u]{fixed/solheat/data6_500.csv};
		\label{fix:heatdata6_500}
		\addplot table[x=x,y=u]{\HeatSolg};
		\label{fix:heatsol_500}
	\end{axis}
\end{tikzpicture}
\caption[.]{
\begin{align*}
&\text{Euler}&&\text{Runge-Kutta}&\\
\ref{fix:heatdata2_500} dt&=0.1& \ref{fix:heatdata5_500} dt&=0.1&\\
\ref{fix:heatdata0_500} dt&=1&\ref{fix:heatdata4_500} dt&=1&\\
&&\ref{fix:heatdata6_500} dt&=2&
\end{align*}
\begin{center}
\ref{fix:heatsol_500} Analytical
\end{center}
}
\end{figure}